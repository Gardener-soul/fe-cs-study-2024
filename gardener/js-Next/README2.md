# Next.js의 요소

## 0. 들어가며
저번 시간에 이어 계속해서 강의를 듣고 있다. 강의를 들으면서 정리한 Next.js의 요소들에 대해서 알아보자.

## 1. SSR vs CSR
1) React - CSR (Client Side Rendering)
   - 평범한 react가 render 되는 방식은 CSR (Client Side Rendering)이다. → 브라우저가 렌더링을 한다는 뜻 (렌더링 : react code를 브라우저가 이해할 수 있는 html로 바꾸는 것)

   → 유저가 최초에 페이지에 도달했을 때는 빈 화면, 그러나 JS 파일이 다운로드되고 실행하면서 화면이 보여지는 것.

    → Client는 JS를 로드하고, 그 후에 JS가 UI를 빌드.


++ SEO 검색 엔진 최적화를 위해서, SSR이 유리하다. 구글은 페이지의 HTML을 보기 때문에 빈 페이지를 보여주지 않는 것이 좋다.  
        
    
2)  Next.js - SSR (Server Side Rendering)
    
    1) Next.js application, 모든 page안의 Component들은 next.js가 그것들을 우선 server에서 render한다. 
    
    2) Next.js는 모든 컴포넌트를 render해서 그 html을 가지고, 그걸 브라우저 request에 대한 response로 준다.
    3) 그렇기 때문에 최상단에 “use client”가 박혀있는 컴포넌트라면 SSR이 진행된다.   
     → 모든 컴포넌트와 페이지들은 먼저 backend단에서 render되고, 이것들이 HTML로 변환된다. 그 HTML이 브라우저에 전달되는 것.

       

## 2. Hydration 
HTML을 React application으로 초기화하는 작업. 사용자가 최초 HTML을 본 뒤에 어떤 일이 발생하는가?

1) 사용자가 다른 페이지로 가고 싶다. 클릭을 하여 요청을 보냄.
2) 페이지에 도달하게 되면 UI를 가지고 있는 dummy HTML들이 존재한다. 이것들이 사용자에게 주어짐.
3) 페이지에 도착하는 즉시, 프레임워크는 즉시 load를 시작한다.
4) React가 load되고, components가 로드되고, 모든 것이 초기화됨. → init(dummy HTML)
5) 우리의 application이 마침내 React가 되는 것.
6) 이후 웹 사이트와 상호작용 가능하고 navigation이 빨라지는 것을 볼 수 있다.
7) Hard refresh 없이 CSR을 할 수 있게 됨.

## 3. “use client”

    0. 위의 **Hydration**의 과정이 모든 Component에 대해 발생하지는 않는다. **(Server side Render는 모든 Component에 대해서 발생하지만!!)**

    1. 그렇다면? Client 단에서 Hydrate 되어야할 Component는 Client단에서 Interactive 하게 동작하는 Component 들이다.
    2. 예를 들어 useState를 사용한다던가 하는 부분들 과 같이 Interactive한 Component들.
    3. 그러한 Component들이 있다면 파일 최상단에 “use client”를 붙인다.

++ 이렇게, Server 단에서 관리되는 Component들과 Client 단에서 관리되는 Component 를 분리할 수 있기 때문에, DB와 통신하거나 API를 Fetch하는 보안상의 작업이 필요한 경우 Server 단에서 관리하는 Component에 서술하여, 보안을 강화할 수 있다. (Clinet들에게 노출되지 않는 부분이기 떄문에)

## 4. Layouts
Applications를 빌드할 때 재사용하는 요소(element)들이 존재한다. 소규모의 규모면 복사 붙여넣기 하는데에 상관이 없겠지만, 만약에 그것들이 많이 늘어난다면? 복사 붙여넣기 없이 어디서나 사용할 수 있는 Layout System을 사용한다. 이것이 위에 서술했던 layout.tsx 파일의 용도다.

```jsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

1. Next.js는 layout 컴포넌트에 있는 export된 Default Component를 렌더링한다. (위 구문의 RootLayout)
2. 이후 URL을 확인하여, 사용자의 화면에 렌더링함.
3. 만약 Gardener 페이지를 렌더링한다고 가정했을 때 사실상의 구조는 아래와 같음

```jsx
<RootLayout>
	<Gardener />
<RootLayout/>
```

++ 특화된 Layout 파일을 만들 수도 있다. 만약 URL : Gardener 에 특별한 layout을 만들고 싶다면, 기존 Gardener 폴더 안에 layout.tsx 파일을 새로 만들어서 작성하는 것! 차이점이라면, 최상단 Layout 파일의 특정 요소들 (metadata, html, body 태그와 같은 것들은 지워줘야한다)

```jsx
import React from "react";

export default function RootLayout({children}: {
  children: React.ReactNode
}) {
  return (
    <div>
      {children}
      &copy; Gardener is Great
    </div>
  )
}
```

![](https://velog.velcdn.com/images/gardener/post/e11cea38-e9a0-4319-8cd2-d913c0e1e7d7/image.png)

![](https://velog.velcdn.com/images/gardener/post/cd4676a9-dff3-46f1-a32c-96cac5602183/image.png)

Hello와 About us에 다른 Layout이 적용된 것을 확인할 수 있다.

이러한 특성은 상위폴더로 이동하여 레이아웃이 있는지 확인하고 레이아웃이 있는 경우에는 해당 레이아웃을 사용하여 하위 항목을 렌더링한다. **레이아웃의 중첩이 가능하다.** 아래 구문의 구조를 따르고 있다고 이해하면 됨.

```jsx
<RootLayout>
	<GardenerLayout>
		<Gardener />
	<GardenerLayout/>
<RootLayout/>
```

## 5. Metadata 
 꼭 내보내야 하는 Object, Page의 Head 부분에 표시 (layout.tsx 파일 안에 위치)

    ```jsx
    export const metadata : Metadata = { // Type은 Metadata로 지정할 수 있다.
      title: {
        template: "%s | NextMovies", // %s를 사용함으로써, 각 URL별 Metadata를 다르게 지정할 수 있다.
        default: "Loading..." // Default 값은 아래와 같이 보인다.
      },
      description: 'Generated by Next.js',
    }
    
    -----------------------------------------
    // Home page의 Metadata를 지정한 것. 위의 %s와 연결되어 Home으로 설정된다.
    
    import {Metadata} from "next";
    
    export const metadata: Metadata = {
      title : "Home"
    }
    
    export default function Gardener(){
      return (
        <div>
          <h1>Hello</h1>
        </div>
      );
    }
    ```

    1. Metadata는 Layout과 달리 중첩되는 특성을 가지고 있다.
    2. 컴포넌트에선는 metatdata를 내보낼 수 없고, 또 matadata는 서버 컴포넌트에만 있을 수 있다.

   ++ 이외에도 공식문서를 참고하면 많은 기능을 사용할 수 있다.

   https://nextjs.org/docs/app/building-your-application/optimizing/metadata