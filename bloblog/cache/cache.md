## 캐시

### ✅ INDEX

[캐싱이란?](#캐싱이란)  
[캐시 제어하기](#캐시-제어하기)

## 캐싱이란?

- 어떤 데이터를 한 번 받아온 후에 그 데이터를 불러온 저장소보다 가까운 곳에 임시로 저장하여, 필요시 더 빠르게 불러와서 사용하는 프로세스 → 웹 사이트 성능 개선에 도움
- 효울적인 아키텍처 패턴
- 메모리 계층 구조에서 캐시는 디스크나 메인 메모리보다 더 빠르게 데이터를 불러와서 사용해야 할 때 쓰인다.

![메모리 계층 구조]()

- 단위 메모리당 비용이 비싸기 때문에 재사용을 많이 할 법한 데이터만 선별적으로 잘 캐싱해야 한다.
- 캐시 메모리의 가격은 현재 메모리 소자 중에서 가장 비싼 편이다.

### 웹 캐시

- 원래는 웹사이트가 실행될 때마다 해당 웹사이트를 그리기 위해 필요한 데이터를 전부 다 불러와야 함 → 사이트 응답 시간을 느리게 하고, 서버 트래픽을 증가시킴
- 이에 대한 대안으로, 사용자가 웹사이트에 접속할 때 정적 컨텐츠를 특정 위치(클라이언트, 네트워크 등)에 저장해두고 꺼내 쓰게 함으로써 사용자 경험을 향상시킬 수 있다.

## 캐시 제어하기

### 리소스 가져오기

- HTTP에서 리소스(Resource)란 웹 브라우저가 HTTP 요청으로 가져올 수 있는 모든 종류의 파일을 가리킨다.
  - e.g. HTML, CSS, JS, 이미지, 비디오 파일
- 웹 브라우저가 서버에서 지금까지 요청한 적이 없는 리소스를 가져오려고 할 때, 서버와 브라우저는 완전한 HTTP 요청/응답을 주고 받는다.
- 이후 HTTP 응답에 포함된 Cache-Control 헤더에 따라 받은 리소스의 생명 주기가 결정된다.

### 캐시의 생명주기

- 유효기간 설정

  - Cache-Control 헤더에 `max-age=<seconds>` 값을 지정하면, 해당 리소스의 캐시가 유효한 시간은 <seconds> 초가 된다.
  - `max-age=31536000` → 1년(31,536,000초)동안 캐시
  - Expires 헤더로 캐시 만료 시간을 지정할 수도 있지만, max-age 속성이 있는 경우 무시된다.
    - e.g. `Expires: Thu, 29 Aug 2024 07:28:00 GMT`

  > +) s-maxage : 중간 서버에 적용하는 max-age 값을 설정

- 리소스 유효 기간이 지나기 전이라면, 브라우저는 서버에 요청을 보내지 않고 특정 위치에서 캐시를 읽어와 사용한다.

- 유효 기간이 지났다면, 재검증을 수행한다.

  - 재검증 요청 헤더
    | If-None-Match | 캐시된 리소스의 `ETag` 값과 현재 서버 리소스의 `ETag` 값이 같은지 확인합니다. |
    | ----------------- | -------------------------------------------------------------------------------- |
    | If-Modified-Since | 캐시된 리소스의 `Last-Modified` 값 이후에 서버 리소스가 수정되었는지 확인합니다. |

      <aside>

        🖤 ETag 속성

        HTTP 헤더의 ETag는 특정 버전의 리소스를 식별한다. 웹 서버가 내용을 확인하고 변하지 않았으면, 이 ETag가 동일한 값을 그대로 가지고 있게 되어 웹 서버로 전체 요청을 보내지 않기 때문에 효율적으로 캐시를 관리할 수 있다. 만약 해당 요청의 리소스가 변경되었다면 새로운 ETag가 생성된다. 요구사항에 따라 서버에서 ETag가 무기한 지속되도록 설정하는 것도 가능하다.

      </aside>

  - 재검증 결과 브라우저의 캐시가 유효하다면 서버는 `304 Not Modified` 요청을 내려준다.
  - 캐시가 유효하지 않으면, 서버는 `200 OK` 또는 적합한 상태 코드를 본문과 함께 내려준다.

### no-cache 와 no-store

|      | no-cache                                                           | no-store                                                   |
| ---- | ------------------------------------------------------------------ | ---------------------------------------------------------- |
| 의미 | 캐시를 함 + 불러올 때마다 서버에 재검증 / `max-age=0` 과 의미 동일 | 캐싱을 하지 않음                                           |
| 특징 | 서버 요청에 대한 시간이 소요될 수 있음                             | 일반적으로 개인정보 등 private한 데이터가 있는 경우 사용함 |

### public과 private

- CDN과 같은 중간 서버가 특정 리소스를 캐시할 수 있는지 여부를 지정하기 위해 헤더 값으로 추가
- public : 모든 사람과 중간 서버가 캐시를 저장할 수 있음
- private : 가장 끝의 사용자 브라우저만 캐시를 저장할 수 있음

<aside>

    ➕ HTML meta 태그로 캐시 컨트롤

    <META HTTP-EQUIV="EXPIRES" CONTENT="Mon, 22 Jul 2002 11:12:01 GMT">
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">

    위처럼 HTML Meta Tag를 페이지에 삽입하여 컨트롤 → 지금은 더 이상 사용하지 않는다!

</aside>

> 👀 **참고자료**
>
> https://toss.tech/article/smart-web-service-cache  
> https://yozm.wishket.com/magazine/detail/2341/  
> https://developer.mozilla.org/ko/docs/Web/HTTP/Caching  
> https://mechaniccoder.tistory.com/49
